var save_method,table_diagnosa,table_tindakan,table_lab,table_logistik,pid,id_peg,id_reg;function pilih_pasien(e){$.ajax({type:"post",url:base_url+"rekam_medik/hasil_pilih_pasien?unencrypted=true",data:{enc_id:e},dataType:"json",success:function(a){$("#tabel_pasien tbody").html(a.data),id_reg=a.data_id.id_reg,id_peg=a.data_id.id_peg,reloadFormDiagnosaTabel(e),reloadFormTindakanRiwayatTabel(e),reloadFormTindakanLabRiwayatTabel(e),reloadFormLogisitikRiwayatTabel(e)}})}function reload_table(){table.ajax.reload(null,!1)}function reloadFormDiagnosaTabel(a){$("#CssLoader").removeClass("hidden"),$("#CssLoader").addClass("hidden"),table_diagnosa=$("#tabel_modal_diagnosa_pasien").DataTable({responsive:!0,searchDelay:500,processing:!0,serverSide:!1,bDestroy:!0,ajax:{url:base_url+"rekam_medik/riwayat_diagnosa",type:"POST",data:{id_psn:a,id_reg:null,id_peg:null}},order:[[4,"desc"]],columnDefs:[{targets:[-1],orderable:!1}]})}function reloadFormDiagnosa(){$("#CssLoader").removeClass("hidden"),$.ajax({type:"post",url:base_url+"rekam_medik/load_form_diagnosa/true",data:{id_peg:id_peg,id_psn:pid,id_reg:id_reg},dataType:"json",success:function(a){$("#CssLoader").addClass("hidden"),$("#tabel_modal_diagnosa tbody").html(a.html)}})}function reloadFormTindakanRiwayatTabel(a){$("#CssLoader").removeClass("hidden"),$("#CssLoader").addClass("hidden"),table_tindakan=$("#tabel_modal_tindakan_pasien").DataTable({responsive:!0,searchDelay:500,processing:!0,serverSide:!1,bDestroy:!0,ajax:{url:base_url+"rekam_medik/riwayat_tindakan",type:"POST",data:{id_psn:a,id_reg:null,id_peg:null}},order:[[5,"desc"]],columnDefs:[{targets:3,className:"text-right"}]})}function reloadFormTindakan(){resetFormTindakan(),$("#CssLoader").removeClass("hidden"),$.ajax({type:"post",url:base_url+"rekam_medik/load_form_tindakan/true",data:{id_peg:id_peg,id_psn:pid,id_reg:id_reg},dataType:"json",success:function(a){$("#CssLoader").addClass("hidden"),$("#tabel_modal_tindakan tbody").html(a.html)}})}function reloadFormTindakanLabRiwayatTabel(a){$("#CssLoader").removeClass("hidden"),$("#CssLoader").addClass("hidden"),table_lab=$("#tabel_modal_tindakan_lab_pasien").DataTable({responsive:!0,searchDelay:500,processing:!0,serverSide:!1,bDestroy:!0,ajax:{url:base_url+"rekam_medik/riwayat_tindakan_lab",type:"POST",data:{id_psn:a,id_reg:null,id_peg:null}},columnDefs:[{targets:[-1],orderable:!1}]})}function reloadFormLogisitikRiwayatTabel(a){$("#CssLoader").removeClass("hidden"),$("#CssLoader").addClass("hidden"),table_logistik=$("#tabel_modal_logistik_pasien").DataTable({responsive:!0,searchDelay:500,processing:!0,serverSide:!1,bDestroy:!0,ajax:{url:base_url+"rekam_medik/riwayat_logistik",type:"POST",data:{id_psn:a,id_reg:null,id_peg:null}},order:[[3,"desc"]],columnDefs:[{targets:[-1],orderable:!1}]})}function reloadFormLogistik(){resetFormLogistik(),$("#CssLoader").removeClass("hidden"),$.ajax({type:"post",url:base_url+"rekam_medik/load_form_logistik/true",data:{id_peg:id_peg,id_psn:pid,id_reg:id_reg},dataType:"json",success:function(a){$("#ket_resep").val(a.ket_resep),$("#CssLoader").addClass("hidden"),$("#tabel_modal_logistik tbody").html(a.html)}})}function openModalRiwayat(a){var e="div_"+a+"_modal";"diagnosa"==a?(initOpsiDiagnosa(),reloadFormDiagnosa()):"tindakan"==a?(initOpsiTindakan(),reloadFormTindakan()):"logistik"==a&&(initOpsiLogistik(),reloadFormLogistik()),$("#"+e).modal("show")}$(document).ready(function(){let a=new URL(window.location.href);""==(pid=a.searchParams.get("pid"))&&null==pid||pilih_pasien(pid),$("#pid").select2(),$("input.numberinput").bind("keypress",function(a){return 8==a.which||0==a.which||!(a.which<48||57<a.which)||46==a.which})});const initOpsiDiagnosa=()=>{$("#fm_diagnosa").data("select2")&&$("#fm_diagnosa").select2("destroy"),$("#fm_diagnosa").select2({tokenSeparators:[","," "],minimumInputLength:0,minimumResultsForSearch:5,ajax:{url:base_url+"master_diagnosa/get_select_diagnosa",dataType:"json",type:"GET",data:function(a){return{term:a.term}},processResults:function(a){return{results:$.map(a,function(a){return{text:a.text,id:a.id,kode:a.kode,html:a.html}})}}}})},initOpsiTindakan=()=>{$("#tdk_tindakan").data("select2")&&$("#tdk_tindakan").select2("destroy"),$("#tdk_tindakan").select2({tokenSeparators:[","," "],minimumInputLength:0,minimumResultsForSearch:5,ajax:{url:base_url+"master_tindakan/get_select_tindakan",dataType:"json",type:"GET",data:function(a){return{term:a.term}},processResults:function(a){return{results:$.map(a,function(a){return{text:a.text,id:a.id,kode:a.kode,nama:a.nama,harga:a.harga,harga_raw:a.harga_raw,is_all_gigi:a.is_all_gigi,disc_persen:a.disc_persen,harga_nett:a.harga_nett,harga_nett_raw:a.harga_nett_raw,is_owner:a.is_owner}})}}}})},initOpsiLogistik=()=>{$("#log_logistik").data("select2")&&$("#log_logistik").select2("destroy"),$("#log_logistik").select2({tokenSeparators:[","," "],minimumInputLength:0,minimumResultsForSearch:5,ajax:{url:base_url+"master_logistik/get_select_logistik",dataType:"json",type:"GET",data:function(a){return{term:a.term}},processResults:function(a){return{results:$.map(a,function(a){return{text:a.text,id:a.id,kode:a.kode,nama:a.nama,id_jenis_logistik:a.id_jenis_logistik,harga_jual_raw:a.harga_jual_raw}})}}}})};function save(t){var a="#".concat(t),e=$(a)[0],a=new FormData(e);a.append("id_peg",id_peg),a.append("id_reg",id_reg),a.append("id_psn",pid),"form_anamnesa"==t&&(e=CKEDITOR.instances.anamnesa.getData(),a.append("txt_anamnesa",e)),$("#btnSave").prop("disabled",!0),$("#btnSave").text("Menyimpan Data"),$.ajax({type:"POST",enctype:"multipart/form-data",url:base_url+"riwayat_pasien/simpan_"+t,data:a,dataType:"JSON",processData:!1,contentType:!1,cache:!1,timeout:6e5,success:function(a){if(a.status)swal.fire({title:"Sukses!!",text:a.pesan,type:"success"}).then(function(){$("#btnSave").prop("disabled",!1),$("#btnSave").text("Simpan"),"form_diagnosa"==t?(reloadFormDiagnosa(),reloadFormDiagnosaTabel(pid)):"form_tindakan"==t?(reloadFormTindakan(),reloadFormTindakanRiwayatTabel(pid)):"form_logistik"==t?(reloadFormLogistik(),reloadFormLogisitikRiwayatTabel(pid)):$("#"+activeModal).modal("hide")});else{for(var e=0;e<a.inputerror.length;e++)0==a.is_select2[e]?($('[name="'+a.inputerror[e]+'"]').addClass("is-invalid"),$('[name="'+a.inputerror[e]+'"]').next().text(a.error_string[e]).addClass("invalid-feedback")):$('[name="'+a.inputerror[e]+'"]').next().next().text(a.error_string[e]).addClass("invalid-feedback-select");$("#btnSave").prop("disabled",!1),$("#btnSave").text("Simpan")}},error:function(a){console.log("ERROR : ",a),$("#btnSave").prop("disabled",!1),$("#btnSave").text("Simpan")}})}const resetFormTindakan=()=>{$("#form_tindakan select[name='tdk_tindakan']").val("").trigger("change"),$("#form_tindakan select[name='tdk_dokter']").val("").trigger("change"),$("#form_tindakan input[name='tdk_gigi_num']").val(""),$("#form_tindakan input[name='tdk_gigi_txt']").val(""),$("#form_tindakan input[name='tdk_kode']").val("")},resetFormLogistik=()=>{$("#form_logistik select[name='log_logistik']").val("").trigger("change"),$("#form_logistik select[name='log_dokter']").val("").trigger("change"),$("#form_logistik input[name='log_qty']").val("")};function hapus_diagnosa_det(e){swalConfirmDelete.fire({title:"Hapus Data Diagnosa ?",text:"Data Akan dihapus ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus Data !",cancelButtonText:"Tidak, Batalkan!",reverseButtons:!0}).then(a=>{a.value?$.ajax({url:base_url+"rekam_medik/delete_data_diagnosa_det/true",type:"POST",dataType:"JSON",data:{id:e},success:function(a){swalConfirm.fire("Berhasil Hapus Data!",a.pesan,"success"),reloadFormDiagnosa(),reloadFormDiagnosaTabel(pid)},error:function(a,e,t){Swal.fire("Terjadi Kesalahan")}}):a.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}function hapus_tindakan_det(e){swalConfirmDelete.fire({title:"Hapus Data Tindakan ?",text:"Data Akan dihapus ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus Data !",cancelButtonText:"Tidak, Batalkan!",reverseButtons:!0}).then(a=>{a.value?$.ajax({url:base_url+"rekam_medik/delete_data_tindakan_det/true",type:"POST",dataType:"JSON",data:{id:e},success:function(a){swalConfirm.fire("Berhasil Hapus Data!",a.pesan,"success"),reloadFormTindakan(),reloadFormTindakanRiwayatTabel(pid)},error:function(a,e,t){Swal.fire("Terjadi Kesalahan")}}):a.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}function hapus_logistik_det(e){swalConfirmDelete.fire({title:"Hapus Data logistik ?",text:"Data Akan dihapus ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus Data !",cancelButtonText:"Tidak, Batalkan!",reverseButtons:!0}).then(a=>{a.value?$.ajax({url:base_url+"rekam_medik/delete_data_logistik_det/true",type:"POST",dataType:"JSON",data:{id:e},success:function(a){swalConfirm.fire("Berhasil Hapus Data!",a.pesan,"success"),reloadFormLogistik(),reloadFormLogisitikRiwayatTabel(pid)},error:function(a,e,t){Swal.fire("Terjadi Kesalahan")}}):a.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}