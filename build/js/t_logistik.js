$(document).ready(function(){initOpsiLogistik(),$("#logistik").on("select2:selecting",function(e){e=e.params.args.data;$("#form_logistik input[name='harga_jual_raw']").val(e.harga_jual_raw)})});const formPintasanLogistik=()=>{initOpsijenisLogistik(),$("#modalPintasanLogistik").modal("show")},initOpsijenisLogistik=()=>{$("#form_master_logistik select[name='jenis']").data("select2")&&$("#form_master_logistik select[name='jenis']").select2("destroy"),$("#form_master_logistik select[name='jenis']").select2({tokenSeparators:[","," "],minimumInputLength:0,minimumResultsForSearch:5,ajax:{url:base_url+"master_logistik/get_select_jenis_logistik",dataType:"json",type:"GET",data:function(e){return{term:e.term}},processResults:function(e){return{results:$.map(e,function(e){return{text:e.text,id:e.id}})}}}})},initOpsiLogistik=()=>{$("#logistik").data("select2")&&$("#logistik").select2("destroy"),$("#logistik").select2({tokenSeparators:[","," "],minimumInputLength:0,minimumResultsForSearch:5,ajax:{url:base_url+"master_logistik/get_select_logistik",dataType:"json",type:"GET",data:function(e){return{term:e.term}},processResults:function(e){return{results:$.map(e,function(e){return{text:e.text,id:e.id,kode:e.kode,nama:e.nama,id_jenis_logistik:e.id_jenis_logistik,harga_jual_raw:e.harga_jual_raw}})}}}})};function reloadFormLogistik(){$("#CssLoader").removeClass("hidden"),$.ajax({type:"post",url:base_url+"rekam_medik/load_form_logistik",data:{id_peg:id_peg,id_psn:id_psn,id_reg:id_reg},dataType:"json",success:function(e){$("#ket_resep").val(e.ket_resep),$("#CssLoader").addClass("hidden"),$("#tabel_modal_logistik tbody").html(e.html)}})}function simpanHeader(){$("#btnSaveHeader").prop("disabled",!0),$("#btnSaveHeader").text("Menyimpan Data ....");let a=$("#ket_resep").val();swalConfirm.fire({title:"Perhatian",text:"Apakah Anda ingin Menyimpan Keterangan Resep ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya !",cancelButtonText:"Tidak !",reverseButtons:!1}).then(e=>{e.value?$.ajax({type:"POST",enctype:"multipart/form-data",url:base_url+"rekam_medik/simpan_keterangan_resep",data:{id_peg:id_peg,id_psn:id_psn,id_reg:id_reg,keteranganResep:a},dataType:"JSON",success:function(e){e.status&&swalConfirm.fire("Berhasil Menambah Data!",e.pesan,"success").then(e=>{e.value&&reloadFormLogistik()}),$("#btnSaveHeader").prop("disabled",!1),$("#btnSaveHeader").text("Simpan")},error:function(e){console.log("ERROR : ",e),createAlert("Opps!","Terjadi Kesalahan","Coba Lagi nanti","danger",!0,!1,"pageMessages"),$("#btnSaveHeader").prop("disabled",!1),$("#btnSaveHeader").text("Simpan")}}):e.dismiss===Swal.DismissReason.cancel&&(swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error"),$("#btnSaveHeader").prop("disabled",!1),$("#btnSaveHeader").text("Simpan"))})}function hapus_logistik_det(a){swalConfirmDelete.fire({title:"Hapus Data logistik ?",text:"Data Akan dihapus ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus Data !",cancelButtonText:"Tidak, Batalkan!",reverseButtons:!0}).then(e=>{e.value?$.ajax({url:base_url+"rekam_medik/delete_data_logistik_det",type:"POST",dataType:"JSON",data:{id:a},success:function(e){swalConfirm.fire("Berhasil Hapus Data!",e.pesan,"success"),reloadFormLogistik()},error:function(e,a,t){Swal.fire("Terjadi Kesalahan")}}):e.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}function saveMasterLogistik(){var e=$("#form_master_logistik")[0];let a=new FormData(e);$("#btnSaveMasterLogistik").prop("disabled",!0),$("#btnSaveMasterLogistik").text("Menyimpan Data"),swalConfirm.fire({title:"Perhatian !!",text:"Apakah anda yakin menambah data ini ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Tidak",reverseButtons:!0}).then(e=>{e.value?$.ajax({type:"POST",enctype:"multipart/form-data",url:base_url+"master_logistik/add_data_logistik",data:a,dataType:"JSON",processData:!1,contentType:!1,cache:!1,timeout:6e5,success:function(e){if(e.status)swal.fire("Sukses!!","Aksi Berhasil","success"),$("#btnSaveMasterLogistik").prop("disabled",!1),$("#btnSaveMasterLogistik").text("Simpan"),reset_modal_form_logistik(),initOpsiLogistik(),$("#modalPintasanLogistik").modal("hide");else{for(var a=0;a<e.inputerror.length;a++)"jabatans"!=e.inputerror[a]?($('[name="'+e.inputerror[a]+'"]').addClass("is-invalid"),$('[name="'+e.inputerror[a]+'"]').next().text(e.error_string[a]).addClass("invalid-feedback")):$($("#jabatans").data("select2").$container).addClass("has-error");$("#btnSaveMasterLogistik").prop("disabled",!1),$("#btnSaveMasterLogistik").text("Simpan")}},error:function(e){console.log("ERROR : ",e),$("#btnSaveMasterLogistik").prop("disabled",!1),$("#btnSaveMasterLogistik").text("Simpan"),reset_modal_form_logistik(),$("#modalPintasanLogistik").modal("hide")}}):e.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}function reset_modal_form_logistik(){$("#form_master_logistik")[0].reset(),$(".append-opt").remove(),$("div.form-group").children().removeClass("is-invalid invalid-feedback"),$("span.help-block").text(""),$("#div_pass_lama").css("display","none")}