var save_method,table;let id_peg,id_psn,id_reg,pid,biaya_raw_global;$(document).ready(function(){$("#div_opt_kredit").css("display","none"),$("#div_opt_diskon_nominal").css("display","none"),$("#div_opt_diskon_persen").css("display","none");let a=new URL(window.location.href);pid=a.searchParams.get("pid"),""==pid&&null==pid||pilih_pasien_pulang(pid),$("input.numberinput").bind("keypress",function(a){return 8==a.which||0==a.which||!(a.which<48||57<a.which)||46==a.which}),$('input:radio[name="jenis_bayar"]').change(function(){$(this).is(":checked")&&"nontunai"==$(this).val()?$("#div_opt_kredit").slideDown():$("#div_opt_kredit").slideUp()}),$("#jenis_diskon").change(function(a){$("#disc_persen").val(0),$("#disc_rp_raw").val(0),$("#disc_rp").val(0),$("#disc_nilai_raw").val(0),$("#total_biaya_nett_raw").val(biaya_raw_global),$("#biaya").val(formatMoney(Number(biaya_raw_global))),"nominal"==this.value?($("#div_opt_diskon_nominal").slideDown(),$("#div_opt_diskon_persen").slideUp()):"persen"==this.value?($("#div_opt_diskon_nominal").slideUp(),$("#div_opt_diskon_persen").slideDown()):"none"==this.value&&($("#div_opt_diskon_nominal").slideUp(),$("#div_opt_diskon_persen").slideUp())}),$("#form_pembayaran").submit(function(a){a.preventDefault()}),$("#form_pembayaran").submit(function(a){a.preventDefault(),$("#btnSave").prop("disabled",!0),$("#btnSave").text("Menyimpan Data ....");var a=$("#form_pembayaran")[0],e=new FormData(a);swalConfirm.fire({title:"Perhatian",text:"Apakah Anda ingin Membayar Transaksi ini ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya !",cancelButtonText:"Tidak !",reverseButtons:!1}).then(a=>{a.value?$.ajax({type:"POST",enctype:"multipart/form-data",url:base_url+"pembayaran/simpan_data",data:e,dataType:"JSON",processData:!1,contentType:!1,cache:!1,timeout:6e5,success:function(e){if(e.status)swalConfirm.fire("Berhasil Menambah Data!",e.pesan,"success").then(a=>{a.value&&($(".div-button-area").html(e.html_button),printStruk(e.id_trans))});else{for(var a=0;a<e.inputerror.length;a++)"pegawai"!=e.inputerror[a]?($('[name="'+e.inputerror[a]+'"]').addClass("is-invalid"),$('[name="'+e.inputerror[a]+'"]').next().text(e.error_string[a]).addClass("invalid-feedback")):$('[name="'+e.inputerror[a]+'"]').next().next().text(e.error_string[a]).addClass("invalid-feedback-select");$("#btnSave").prop("disabled",!1),$("#btnSave").text("Simpan")}},error:function(a){console.log("ERROR : ",a),createAlert("Opps!","Terjadi Kesalahan","Coba Lagi nanti","danger",!0,!1,"pageMessages"),$("#btnSave").prop("disabled",!1),$("#btnSave").text("Simpan")}}):a.dismiss===Swal.DismissReason.cancel&&(swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error"),$("#btnSave").prop("disabled",!1),$("#btnSave").text("Simpan"))})}),table=$("#tabel_index").DataTable({responsive:!0,searchDelay:500,processing:!0,serverSide:!0,ajax:{url:base_url+"pembayaran/list_data",type:"POST"},language:{decimal:",",thousands:"."},columnDefs:[{targets:6,className:"text-right"},{targets:7,className:"text-right"},{targets:8,className:"text-right"}]}),$(".modal").on("hidden.bs.modal",function(){reset_modal_form_import()})});const show_modal_pasien=()=>{$("#modal_pilih_pasien").modal("show"),$("#modal_pilih_pasien_title").text("Pilih Data Registrasi")},cari_pasien=()=>{var a=$("#form_cari_pasien")[0],a=new FormData(a);$.ajax({type:"POST",enctype:"multipart/form-data",url:base_url+"pembayaran/cari_pasien_pulang",data:a,dataType:"JSON",processData:!1,contentType:!1,cache:!1,timeout:6e5,success:function(a){a.status?$("#tabel_pilih_pasien tbody").html(a.data):swalConfirm.fire("Gagal","Data Tidak Ditemukan","error")}})},pilih_pasien_pulang=a=>{$.ajax({type:"post",url:base_url+"pembayaran/hasil_pilih_pasien",data:{enc_id:a},dataType:"json",success:function(a){$("#tabel_pasien tbody").html(a.data),$("#header_pembayaran").html(a.html_header),$("#detail_pembayaran").html(a.html_detail),$("#id_reg").val(a.data_id.id_reg),$("#id_psn").val(a.data_id.id_psn),$("#id_peg").val(a.data_id.id_peg),$("#total_biaya_raw").val(a.tot_biaya),$("#total_biaya_nett_raw").val(a.tot_biaya),$("#biaya").val(a.tot_biaya),id_reg=a.data_id.id_reg,id_peg=a.data_id.id_peg,id_psn=a.data_id.id_psn,biaya_raw_global=a.tot_biaya}})},submit_pasien_pulang=a=>{location.href=base_url+"pembayaran/add?pid="+a},hitungKembalian=()=>{let a=$("#pembayaran").inputmask("unmaskedvalue");var e=$("#total_biaya_nett_raw").val();a=a.replace(",","."),hargaFix=parseFloat(a).toFixed(2),totalBiayaFix=parseFloat(e).toFixed(2);e=hargaFix-e;kembalianFix=Number.isNaN(e)?0:parseFloat(e).toFixed(2);e=Number(kembalianFix).toFixed(2);$("#kembalian").val(formatMoney(Number(e))),$("#pembayaran_raw").val(hargaFix),$("#kembalian_raw").val(kembalianFix),kembalianFix<0?$(".btnSubmit").attr("disabled","disabled"):$(".btnSubmit").removeAttr("disabled")},setDiscRpRaw=()=>{var a=$("#disc_rp").inputmask("unmaskedvalue"),a=parseFloat(a).toFixed(2);$("#disc_rp_raw").val(a),$("#disc_nilai_raw").val(a);a=$("#total_biaya_raw").val()-a;$("#total_biaya_nett_raw").val(a),$("#biaya").val(formatMoney(Number(a)))},setDiscPersenRaw=a=>{var e=$("#total_biaya_raw").val(),a=e*a/100;$("#disc_nilai_raw").val(parseFloat(a).toFixed(2));a=e-a;$("#total_biaya_nett_raw").val(a),$("#biaya").val(formatMoney(Number(a)))},detail_trans=a=>{$.ajax({url:base_url+"pembayaran/detail_pembayaran",type:"POST",dataType:"JSON",data:{enc_id:a},success:function(a){$("#klinik_det").text(a.old_data.nama_klinik),$("#no_reg_det").text(a.old_data.no_reg),$("#tgl_reg_det").text(moment(a.old_data.tanggal,"YYYY-MM-DD").format("DD-MM-YYYY")),$("#user_det").text(a.old_data.username),$("#pasien_det").text(a.old_data.nama),$("#rm_det").text(a.old_data.no_rm),$("#jenis_det").text(a.old_data.jenis_bayar),$("#kredit_det").text(a.old_data.nama_kredit),$("tbody#rincian_det").html(a.html_rinci),$("#modal_detail").modal("show"),$("#modal_title_det").text("Detail Pembayaran")},error:function(a,e,t){alert("Error get data from ajax")}})},printStruk=a=>{$.ajax({type:"get",url:base_url+"pembayaran/cetak_struk/"+a,dataType:"json",success:function(a){popupPrint(a.html)}})},popupPrint=a=>{let e=window.open("","Receipt","height=400,width=600");e.document.write(a),e.print(),e.close()};function reload_table(){table.ajax.reload(null,!1)}function delete_pasien(e){swalConfirmDelete.fire({title:"Hapus Data Pasien ?",text:"Data Akan dihapus permanen ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus Data !",cancelButtonText:"Tidak, Batalkan!",reverseButtons:!0}).then(a=>{a.value?$.ajax({url:base_url+"data_pasien/delete_data",type:"POST",dataType:"JSON",data:{id:e},success:function(a){swalConfirm.fire("Berhasil Hapus Pasien!",a.pesan,"success"),table.ajax.reload()},error:function(a,e,t){Swal.fire("Terjadi Kesalahan")}}):a.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}function reset_modal_form_import(){$("#form_import_excel")[0].reset(),$("#label_file_excel").text("Pilih file excel yang akan diupload")}function import_excel(){$("#modal_import_excel").modal("show"),$("#modal_import_title").text("Import data user")}function import_data_excel(){var a=$("#form_import_excel")[0],a=new FormData(a);$("#btnSaveImport").attr("disabled",!0),$("#btnSaveImport").text("Import Data"),$.ajax({type:"POST",enctype:"multipart/form-data",url:base_url+"data_pasien/import_data",data:a,dataType:"JSON",processData:!1,contentType:!1,success:function(a){a.status?swal.fire("Sukses!!",a.pesan,"success"):swal.fire("Gagal!!",a.pesan,"error"),$("#btnSaveImport").attr("disabled",!1),$("#btnSaveImport").text("Simpan"),reset_modal_form_import(),$(".modal").modal("hide"),table.ajax.reload()},error:function(a){console.log("ERROR : ",a),$("#btnSaveImport").attr("disabled",!1),$("#btnSaveImport").text("Simpan"),reset_modal_form_import(),$(".modal").modal("hide"),table.ajax.reload()}})}function handle_boolean(a){return"1"==a?"Ya":"Tidak"}