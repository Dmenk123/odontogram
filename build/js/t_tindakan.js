$(document).ready(function(){initOpsiTindakan(),$("#tindakan").on("select2:selecting",function(a){$("#input_tdk_gigi_num").val(""),$("#input_tdk_gigi_txt").val("");a=a.params.args.data;a.is_all_gigi?($("#input_tdk_gigi_num").slideUp(),$("#input_tdk_gigi_txt").slideDown().val("all")):($("#input_tdk_gigi_num").slideDown(),$("#input_tdk_gigi_txt").slideUp().val("")),$("#form_tindakan input[name='tdk_kode']").val(a.kode),$("#form_tindakan input[name='tdk_tindakan']").val(a.nama),"1"!=a.is_owner?$("#form_tindakan input[name='tdk_harga']").val(a.harga).attr("disabled",!0):$("#form_tindakan input[name='tdk_harga']").val(a.harga).attr("disabled",!1),$("#form_tindakan input[name='tdk_harga_raw']").val(a.harga_raw),$("#form_tindakan input[name='tdk_diskon']").val(a.disc_persen),$("#form_tindakan input[name='tdk_nett']").val(a.harga_nett),$("#form_tindakan input[name='tdk_nett_raw']").val(a.harga_nett_raw)})});const formPintasanTindakan=()=>{$("#modalPintasanTindakan").modal("show")},initOpsiTindakan=()=>{$("#tindakan").data("select2")&&$("#tindakan").select2("destroy"),$("#tindakan").select2({tokenSeparators:[","," "],minimumInputLength:0,minimumResultsForSearch:5,ajax:{url:base_url+"master_tindakan/get_select_tindakan",dataType:"json",type:"GET",data:function(a){return{term:a.term}},processResults:function(a){return{results:$.map(a,function(a){return{text:a.text,id:a.id,kode:a.kode,nama:a.nama,harga:a.harga,harga_raw:a.harga_raw,is_all_gigi:a.is_all_gigi,disc_persen:a.disc_persen,harga_nett:a.harga_nett,harga_nett_raw:a.harga_nett_raw,is_owner:a.is_owner}})}}}})};function reloadFormTindakan(){resetFormTindakan(),$("#CssLoader").removeClass("hidden"),$.ajax({type:"post",url:base_url+"rekam_medik/load_form_tindakan",data:{id_peg:id_peg,id_psn:id_psn,id_reg:id_reg},dataType:"json",success:function(a){$("#CssLoader").addClass("hidden"),$("#tabel_modal_tindakan tbody").html(a.html)}})}function hapus_tindakan_det(n){swalConfirmDelete.fire({title:"Hapus Data Tindakan ?",text:"Data Akan dihapus ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus Data !",cancelButtonText:"Tidak, Batalkan!",reverseButtons:!0}).then(a=>{a.value?$.ajax({url:base_url+"rekam_medik/delete_data_tindakan_det",type:"POST",dataType:"JSON",data:{id:n},success:function(a){swalConfirm.fire("Berhasil Hapus Data!",a.pesan,"success"),reloadFormTindakan()},error:function(a,n,t){Swal.fire("Terjadi Kesalahan")}}):a.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}const resetFormTindakan=()=>{$("#tindakan").val("").trigger("change"),$("#form_tindakan input[name='tdk_gigi_num']").val(""),$("#form_tindakan input[name='tdk_gigi_txt']").val(""),$("#form_tindakan input[name='tdk_kode']").val(""),$("#form_tindakan input[name='tdk_tindakan']").val(""),$("#form_tindakan input[name='tdk_harga']").val(""),$("#form_tindakan input[name='tdk_harga_raw']").val(""),$("#form_tindakan input[name='tdk_ket']").val(""),$("#form_tindakan input[name='tdk_diskon']").val(""),$("#form_tindakan input[name='tdk_nett']").val(""),$("#form_tindakan input[name='tdk_nett_raw']").val("")},setHargaRaw=()=>{let a=$("#tdk_diskon").val(),n=$("#tdk_harga").inputmask("unmaskedvalue");var t=parseFloat(n).toFixed(2),e=parseFloat(n-n*a/100).toFixed(2);$("#tdk_harga_raw").val(t),$("#tdk_nett_raw").val(e),$("#tdk_nett").val(formatMoney(Number(e)))};function saveMasterTindakan(){var a=$("#form_master_tindakan")[0];let n=new FormData(a);$("#btnSaveMasterTindakan").prop("disabled",!0),$("#btnSaveMasterTindakan").text("Menyimpan Data"),swalConfirm.fire({title:"Perhatian !!",text:"Apakah anda yakin menambah data ini ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Tidak",reverseButtons:!0}).then(a=>{a.value?$.ajax({type:"POST",enctype:"multipart/form-data",url:base_url+"master_tindakan/add_data_tindakan",data:n,dataType:"JSON",processData:!1,contentType:!1,cache:!1,timeout:6e5,success:function(a){if(a.status)swal.fire("Sukses!!","Aksi Berhasil","success"),$("#btnSaveMasterTindakan").prop("disabled",!1),$("#btnSaveMasterTindakan").text("Simpan"),reset_modal_form_tindakan(),initOpsiTindakan(),$("#modalPintasanTindakan").modal("hide");else{for(var n=0;n<a.inputerror.length;n++)"jabatans"!=a.inputerror[n]?($('[name="'+a.inputerror[n]+'"]').addClass("is-invalid"),$('[name="'+a.inputerror[n]+'"]').next().text(a.error_string[n]).addClass("invalid-feedback")):$($("#jabatans").data("select2").$container).addClass("has-error");$("#btnSaveMasterTindakan").prop("disabled",!1),$("#btnSaveMasterTindakan").text("Simpan")}},error:function(a){console.log("ERROR : ",a),$("#btnSaveMasterTindakan").prop("disabled",!1),$("#btnSaveMasterTindakan").text("Simpan"),reset_modal_form_tindakan(),$("#modalPintasanTindakan").modal("hide")}}):a.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}function reset_modal_form_tindakan(){$("#form_master_tindakan")[0].reset(),$(".append-opt").remove(),$("div.form-group").children().removeClass("is-invalid invalid-feedback"),$("span.help-block").text(""),$("#div_pass_lama").css("display","none")}