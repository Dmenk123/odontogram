var save_method,table;function add_menu(){reset_modal_form(),save_method="add",$("#modal_honor_dokter").modal("show"),$("#modal_title").text("Tambah Honor Baru")}function show_modal_honor(){$(".modal").modal("hide"),$("#modal_honor_dokter").modal("show"),$("#modal_title").text("Tambah Honor Baru")}function tambah_tindakan(){var a=$("#form-honor-tindakan")[0],a=new FormData(a);$("#btnSaveTindakan").prop("disabled",!0),$("#btnSaveTindakan").text("Menyimpan Data"),$.ajax({type:"POST",enctype:"multipart/form-data",url:base_url+"honor_dokter/add_data_honor_tindakan",data:a,dataType:"JSON",processData:!1,contentType:!1,cache:!1,timeout:6e5,success:function(a){if(a.status)swalConfirm.fire("Berhasil Tambah Tindakan!",a.pesan,"success"),$("#btnSaveTindakan").prop("disabled",!1),$("#btnSaveTindakan").text("Simpan Tindakan"),load_form_tindakan(a.id_dokter);else{if(a.is_alert)swalConfirm.fire("Oops !!!",a.pesan,"error");else for(var e=0;e<a.inputerror.length;e++)"id_tindakan"!=a.inputerror[e]?($('[name="'+a.inputerror[e]+'"]').addClass("is-invalid"),$('[name="'+a.inputerror[e]+'"]').next().text(a.error_string[e]).addClass("invalid-feedback")):$('[name="'+a.inputerror[e]+'"]').next().next().text(a.error_string[e]).addClass("invalid-feedback-select");$("#btnSaveTindakan").prop("disabled",!1),$("#btnSaveTindakan").text("Simpan")}},error:function(a){console.log("ERROR : ",a),$("#btnSaveTindakan").prop("disabled",!1),$("#btnSaveTindakan").text("Simpan"),reset_modal_form(),$(".modal").modal("hide")}})}function tambah_lab(){var a=$("#form-honor-lab")[0],a=new FormData(a);$("#btnSaveLab").prop("disabled",!0),$("#btnSaveLab").text("Menyimpan Data"),$.ajax({type:"POST",enctype:"multipart/form-data",url:base_url+"honor_dokter/add_data_honor_lab",data:a,dataType:"JSON",processData:!1,contentType:!1,cache:!1,timeout:6e5,success:function(a){if(a.status)swalConfirm.fire("Berhasil Tambah Honor Lab!",a.pesan,"success"),$("#btnSaveLab").prop("disabled",!1),$("#btnSaveLab").text("Simpan Lab"),load_form_lab(a.id_dokter);else{if(a.is_alert)swalConfirm.fire("Oops !!!",a.pesan,"error");else for(var e=0;e<a.inputerror.length;e++)"id_lab"!=a.inputerror[e]?($('[name="'+a.inputerror[e]+'"]').addClass("is-invalid"),$('[name="'+a.inputerror[e]+'"]').next().text(a.error_string[e]).addClass("invalid-feedback")):$('[name="'+a.inputerror[e]+'"]').next().next().text(a.error_string[e]).addClass("invalid-feedback-select");$("#btnSaveLab").prop("disabled",!1),$("#btnSaveLab").text("Simpan")}},error:function(a){console.log("ERROR : ",a),$("#btnSaveTindakan").prop("disabled",!1),$("#btnSaveTindakan").text("Simpan"),reset_modal_form(),$(".modal").modal("hide")}})}function edit_honor(a){reset_modal(),save_method="update",$.ajax({url:base_url+"honor_dokter/edit_data",type:"POST",dataType:"JSON",data:{id:a},success:function(a){$('[name="id_honor"]').val(a.old_data.id),$('[name="honor_visite"]').val(formatAngka(parseInt(a.old_data.honor_visite))),$('[name="honor_tindakan"]').val(a.old_data.tindakan_persen),$('[name="honor_obat"]').val(a.old_data.obat_persen),$('[name="honor_lab"]').val(a.old_data.tindakan_lab_persen),$("#dokter").val(a.old_data.id_dokter).trigger("change"),$("#modal_honor_dokter").modal("show"),$("#modal_title").text("Edit Honor Dokter")},error:function(a,e,t){alert("Error get data from ajax")}})}function formatAngka(a){var e=a.toString().replace(/[^,\d]/g,"").split(","),t=e[0].length%3,n=e[0].substr(0,t),a=e[0].substr(t).match(/\d{3}/gi);return a&&(separator=t?".":"",n+=separator+a.join(".")),n=null!=e[1]?n+","+e[1]:n}function save(){var a;txtAksi="add"==save_method?(a=base_url+"honor_dokter/add_data_honor","Tambah Honor Dokter"):(a=base_url+"honor_dokter/update_data_honor","Edit Honor Dokter");var e=$("#form-honor")[0],e=new FormData(e);$("#btnSave").prop("disabled",!0),$("#btnSave").text("Menyimpan Data"),$.ajax({type:"POST",enctype:"multipart/form-data",url:a,data:e,dataType:"JSON",processData:!1,contentType:!1,cache:!1,timeout:6e5,success:function(a){if(a.status)swal.fire("Sukses!!","Aksi "+txtAksi+" Berhasil","success"),$("#btnSave").prop("disabled",!1),$("#btnSave").text("Simpan"),reset_modal(),$(".modal").modal("hide"),reload_table();else{for(var e=0;e<a.inputerror.length;e++)"dokter"!=a.inputerror[e]?($('[name="'+a.inputerror[e]+'"]').addClass("is-invalid"),$('[name="'+a.inputerror[e]+'"]').next().text(a.error_string[e]).addClass("invalid-feedback")):$('[name="'+a.inputerror[e]+'"]').next().next().text(a.error_string[e]).addClass("invalid-feedback-select");$("#btnSave").prop("disabled",!1),$("#btnSave").text("Simpan")}},error:function(a){console.log("ERROR : ",a),$("#btnSave").prop("disabled",!1),$("#btnSave").text("Simpan"),reset_modal_form(),$(".modal").modal("hide")}})}function bukaFormTindakan(){var a=$("#dokter").val();""!=a?(load_form_tindakan(a),$(".modal").modal("hide"),$("#modal_honor_tindakan").modal("show"),$("#modal_title_tindakan").text("Tambah Honor Tindakan")):swalConfirm.fire("Perhatian!!","Mohon Memilih Dokter Terlebih Dahulu","error")}function load_form_tindakan(a){reset_modal_tindakan(),$.ajax({type:"POST",url:base_url+"honor_dokter/get_data_form_tindakan",data:{id_dokter:a},dataType:"json",success:function(a){$.each(a.tindakan,function(a,e){$("#id_tindakan").append($("<option></option>").val(e.id_tindakan).text(e.nama_tindakan))}),$("#nama_dokter_tindakan").val(a.dokter.nama),$("#id_dokter_tindakan").val(a.dokter.id),$("#tabel-tindakan-dokter tbody").html(a.html)}})}function bukaFormLab(){var a=$("#dokter").val();""!=a?(load_form_lab(a),$(".modal").modal("hide"),$("#modal_honor_lab").modal("show"),$("#modal_title_lab").text("Tambah Honor Laboratorium")):swalConfirm.fire("Perhatian!!","Mohon Memilih Dokter Terlebih Dahulu","error")}function load_form_lab(a){reset_modal_lab(),$.ajax({type:"POST",url:base_url+"honor_dokter/get_data_form_lab",data:{id_dokter:a},dataType:"json",success:function(a){$.each(a.lab,function(a,e){$("#id_lab").append($("<option></option>").val(e.id_laboratorium).text(e.tindakan_lab))}),$("#nama_dokter_lab").val(a.dokter.nama),$("#id_dokter_lab").val(a.dokter.id),$("#tabel-lab-dokter tbody").html(a.html)}})}function reset_modal(){reset_modal_form(),reset_modal_tindakan(),reset_modal_lab(),$(".modal").modal("hide")}function reset_modal_tindakan(){$("#id_tindakan").find("option").remove().end().append('<option value="">Silahkan Pilih Tindakan</option>').val(""),$("#form-honor-tindakan")[0].reset(),$("div.form-group").children().removeClass("is-invalid invalid-feedback"),$("span.help-block").text("")}function reset_modal_lab(){$("#id_lab").find("option").remove().end().append('<option value="">Silahkan Pilih Lab</option>').val(""),$("#form-honor-lab")[0].reset(),$("div.form-group").children().removeClass("is-invalid invalid-feedback"),$("span.help-block").text("")}function reset_modal_form(){$("#form-honor")[0].reset(),$(".append-opt").remove(),$("div.form-group").children().removeClass("is-invalid invalid-feedback"),$("span.help-block").text(""),$("#dokter").val("").trigger("change")}function hapus_honor_tindakan(e){swalConfirmDelete.fire({title:"Hapus Data ?",text:"Data Akan dihapus permanen ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus Data !",cancelButtonText:"Tidak, Batalkan!",reverseButtons:!0}).then(a=>{a.value?$.ajax({url:base_url+"honor_dokter/delete_honor_tindakan",type:"POST",dataType:"JSON",data:{id:e},success:function(a){swalConfirm.fire("Berhasil !!!",a.pesan,"success"),load_form_tindakan(a.id_dokter)},error:function(a,e,t){Swal.fire("Terjadi Kesalahan")}}):a.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}function hapus_honor_lab(e){swalConfirmDelete.fire({title:"Hapus Data ?",text:"Data Akan dihapus permanen ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus Data !",cancelButtonText:"Tidak, Batalkan!",reverseButtons:!0}).then(a=>{a.value?$.ajax({url:base_url+"honor_dokter/delete_honor_lab",type:"POST",dataType:"JSON",data:{id:e},success:function(a){swalConfirm.fire("Berhasil !!!",a.pesan,"success"),load_form_lab(a.id_dokter)},error:function(a,e,t){Swal.fire("Terjadi Kesalahan")}}):a.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}function reload_table(){table.ajax.reload(null,!1)}function delete_honor(e){swalConfirmDelete.fire({title:"Hapus Data ?",text:"Data Akan dihapus permanen ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus Data !",cancelButtonText:"Tidak, Batalkan!",reverseButtons:!0}).then(a=>{a.value?$.ajax({url:base_url+"honor_dokter/delete_honor",type:"POST",dataType:"JSON",data:{id:e},success:function(a){swalConfirm.fire("Berhasil !!!",a.pesan,"success"),reload_table()},error:function(a,e,t){Swal.fire("Terjadi Kesalahan")}}):a.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}$(document).ready(function(){$("input.numberinput").bind("keypress",function(a){return 8==a.which||0==a.which||!(a.which<48||57<a.which)||46==a.which}),table=$("#tabel_data").DataTable({responsive:!0,searchDelay:500,processing:!0,serverSide:!0,ajax:{url:base_url+"honor_dokter/list_data",type:"POST"},columnDefs:[{targets:[-1],orderable:!1}]}),$(".modal").on("hidden.bs.modal",function(){reset_modal_tindakan(),reset_modal_lab()})});